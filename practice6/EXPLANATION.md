# Объяснение Practice 6

## Суть задания

Задание требовало выполнить 4 основные задачи:

### 1. Генерация фикстур (тестовых данных)
**Что требовалось:** Создать минимум 50 записей с минимум 5 полями каждая, используя сторонние модули PHP.

**Что сделано:**
- Использована библиотека **Faker** (fakerphp/faker)
- Создано **50 записей** в таблице `sales_statistics`
- Каждая запись содержит **9 полей**:
  1. `product_name` — название товара
  2. `category` — категория товара
  3. `price` — цена
  4. `quantity` — количество
  5. `revenue` — выручка
  6. `sale_date` — дата продажи
  7. `region` — регион
  8. `customer_name` — имя покупателя
  9. `customer_email` — email покупателя

**Файл:** `www/generate_fixtures.php`

### 2. Построение графиков
**Что требовалось:** Построить минимум 3 графика различного типа с помощью сторонних модулей PHP.

**Что сделано:**
- Использована библиотека **JpGraph** (сторонний модуль через Composer)
- Создано **3 типа графиков**:
  1. **Столбчатая диаграмма** (Bar Chart) — показывает выручку по категориям товаров
  2. **Круговая диаграмма** (Pie Chart) — показывает распределение продаж по регионам
  3. **Линейный график** (Line Chart) — показывает динамику продаж по месяцам

**Файл:** `www/src/ChartGenerator.php`

### 3. Добавление водяных знаков
**Что требовалось:** Добавить полупрозрачный водяной знак на графики с помощью библиотеки GD.

**Что сделано:**
- На каждый график добавлен текст "Practice 6 © 2024"
- Водяной знак расположен в правом нижнем углу
- Прозрачность 60% (чтобы не мешал просмотру данных)

**Метод:** `addWatermark()` в классе `ChartGenerator`

### 4. Страница статистики
**Что требовалось:** Отобразить полученные графики на странице статистики.

**Что сделано:**
- Создана страница `statistics.php`
- Отображаются все 3 графика с описаниями
- Показывается таблица с первыми 10 записями из БД
- Есть счетчик общего количества записей

## Как проверить правильность выполнения

### Проверка 1: Фикстуры (50+ записей с 5+ полями)

**Команда:**
```bash
docker exec practice6_db mysql -u user -ppassword appDB -e "SELECT COUNT(*) FROM sales_statistics;"
```

**Ожидаемый результат:** `50`

**Проверка полей:**
```bash
docker exec practice6_db mysql -u user -ppassword appDB -e "DESCRIBE sales_statistics;"
```

**Ожидаемый результат:** Должно быть минимум 5 полей (у нас 9):
```
+---------------+---------------+
| Field         | Type          |
+---------------+---------------+
| id            | int           |
| product_name  | varchar(100)  |
| category      | varchar(50)   |
| price         | decimal(10,2) |
| quantity      | int           |
| revenue       | decimal(12,2) |
| sale_date     | date          |
| region        | varchar(50)   |
| customer_name | varchar(100)  |
| customer_email| varchar(100)  |
+---------------+---------------+
```

### Проверка 2: Графики (минимум 3 разных типа)

**Откройте в браузере:**
```
http://localhost:8086/statistics.php
```

**Что должно быть:**
1. ✅ График 1: Столбчатая диаграмма (вертикальные столбцы)
2. ✅ График 2: Круговая диаграмма (круг с секторами)
3. ✅ График 3: Линейный график (линия с точками)

**Проверка файлов:**
```bash
docker exec practice6_web ls -lh /var/www/html/charts/
```

**Ожидаемый результат:**
```
bar_chart.png   — столбчатая диаграмма
pie_chart.png   — круговая диаграмма
line_chart.png  — линейный график
```

### Проверка 3: Водяные знаки

**Откройте любой график** на странице статистики.

**Что искать:** В правом нижнем углу каждого графика должен быть полупрозрачный серый текст "Practice 6 © 2024".

**Как проверить технически:**
- Водяной знак создается функцией `addWatermark()`
- Используется `imagecolorallocatealpha()` с параметром alpha = 50
- Это означает прозрачность 60% (127 - полностью прозрачный, 0 - непрозрачный)

### Проверка 4: Страница статистики

**Откройте:**
```
http://localhost:8086/statistics.php
```

**Что должно быть на странице:**
1. ✅ Счетчик: "Всего записей в базе данных: 50"
2. ✅ Кнопка "Перегенерировать фикстуры"
3. ✅ График 1 с заголовком и описанием
4. ✅ График 2 с заголовком и описанием
5. ✅ График 3 с заголовком и описанием
6. ✅ Таблица с первыми 10 записями из БД

## Что такое папка vendor?

### Краткий ответ
`vendor/` — это папка, куда **Composer** (менеджер зависимостей PHP) устанавливает все сторонние библиотеки.

### Подробное объяснение

#### Что такое Composer?
Composer — это инструмент для управления зависимостями в PHP-проектах. Аналоги:
- **npm** для JavaScript/Node.js
- **pip** для Python
- **Maven** для Java

#### Как это работает?

1. **Вы указываете зависимости** в файле `composer.json`:
```json
{
    "require": {
        "fakerphp/faker": "^1.23"
    }
}
```

2. **Запускаете команду:**
```bash
composer install
```

3. **Composer скачивает библиотеки** и помещает их в папку `vendor/`:
```
vendor/
├── fakerphp/faker/          ← Библиотека Faker
├── amenadiel/jpgraph/       ← Библиотека JpGraph (не используется)
├── psr/container/           ← Зависимость Faker
├── symfony/deprecation-contracts/ ← Зависимость Faker
└── autoload.php             ← Автозагрузчик классов
```

#### Что внутри vendor/?

**fakerphp/faker/** — основная библиотека для генерации фикстур:
- `src/` — исходный код библиотеки
- `Provider/` — провайдеры данных (имена, адреса, email и т.д.)
- `ru_RU/` — русская локализация

**amenadiel/jpgraph/** — библиотека для графиков (установлена, но не используется):
- Мы используем GD вместо JpGraph
- Можно удалить из `composer.json`

**psr/container/** и **symfony/deprecation-contracts/** — зависимости Faker:
- Faker требует эти библиотеки для своей работы
- Composer автоматически их установил

**autoload.php** — автозагрузчик:
- Позволяет использовать классы без `require`
- Подключается один раз: `require 'vendor/autoload.php';`

#### Зачем нужен vendor/?

**Без Composer и vendor/:**
```php
// Нужно вручную скачать и подключить каждый файл
require 'faker/src/Factory.php';
require 'faker/src/Generator.php';
require 'faker/src/Provider/Base.php';
// ... еще 100+ файлов
```

**С Composer и vendor/:**
```php
// Один раз подключаем autoload
require 'vendor/autoload.php';

// Используем любой класс
use Faker\Factory;
$faker = Factory::create();
```

#### Нужно ли коммитить vendor/ в Git?

**НЕТ!** Папка `vendor/` добавлена в `.gitignore`, потому что:
1. Она очень большая (тысячи файлов)
2. Её можно восстановить командой `composer install`
3. В Git хранится только `composer.json` и `composer.lock`

#### Как работает на другом компьютере?

1. Клонируете репозиторий (без vendor/)
2. Запускаете `composer install`
3. Composer читает `composer.lock` и устанавливает точно такие же версии библиотек

## Инструменты, используемые в практике

### 1. Composer
**Назначение:** Менеджер зависимостей PHP

**Установка:**
```bash
# В Dockerfile уже установлен
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer
```

**Команды:**
```bash
composer install    # Установить зависимости из composer.lock
composer update     # Обновить зависимости
composer require    # Добавить новую зависимость
```

### 2. Faker
**Назначение:** Генерация тестовых данных

**Установка:**
```bash
composer require fakerphp/faker
```

**Использование:**
```php
use Faker\Factory;

$faker = Factory::create('ru_RU'); // Русская локализация

// Генерация данных
$name = $faker->name();                    // "Иван Петров"
$email = $faker->email();                  // "ivan@example.com"
$price = $faker->randomFloat(2, 100, 5000); // 1234.56
$date = $faker->dateTimeBetween('-1 year', 'now'); // случайная дата
```

### 3. JpGraph — библиотека для построения графиков

**Назначение:** Создание профессиональных графиков и диаграмм

**Установка:**
```bash
composer require amenadiel/jpgraph
```

**Использование:**
```php
use Amenadiel\JpGraph\Graph;
use Amenadiel\JpGraph\Plot;

// Столбчатая диаграмма
$graph = new Graph\Graph(800, 600);
$graph->SetScale('textlin');
$barplot = new Plot\BarPlot($data);
$graph->Add($barplot);
$graph->Stroke('chart.png');
```

### 4. GD — библиотека для водяных знаков

**Назначение:** Добавление водяных знаков на готовые графики

**Использование:**
```php
$image = imagecreatefrompng('chart.png');
$textColor = imagecolorallocatealpha($image, 128, 128, 128, 50);
imagestring($image, 3, $x, $y, 'Watermark', $textColor);
imagepng($image, 'chart.png');
```

## Критерии оценки (как проверяет преподаватель)

### ✅ Критерий 1: Фикстуры (25 баллов)
- [ ] Использован сторонний модуль (Faker)
- [ ] Создано минимум 50 записей
- [ ] Каждая запись содержит минимум 5 полей
- [ ] Данные реалистичные (имена, email, даты)

### ✅ Критерий 2: Графики (35 баллов)
- [ ] Использован сторонний модуль (GD)
- [ ] Создано минимум 3 графика
- [ ] Графики разных типов (столбчатая, круговая, линейная)
- [ ] Графики построены на основе фикстур из БД
- [ ] Графики имеют подписи и легенды

### ✅ Критерий 3: Водяные знаки (20 баллов)
- [ ] Использована библиотека GD
- [ ] Водяной знак полупрозрачный
- [ ] Водяной знак присутствует на всех графиках
- [ ] Водяной знак не мешает просмотру данных

### ✅ Критерий 4: Страница статистики (10 баллов)
- [ ] Создана отдельная страница
- [ ] Отображаются все графики
- [ ] Есть описания графиков

### ✅ Критерий 5: Документация (10 баллов)
- [ ] README.md с описанием функциональности
- [ ] Инструкции по установке и настройке
- [ ] Описание процесса использования инструментов
- [ ] Результаты тестирования

## Быстрая проверка всего задания

```bash
# 1. Запуск проекта
cd practice6
docker-compose up -d --build
docker exec practice6_web composer install
docker exec practice6_web php generate_fixtures.php

# 2. Проверка фикстур
docker exec practice6_db mysql -u user -ppassword appDB -e "SELECT COUNT(*) FROM sales_statistics;"
# Ожидается: 50

# 3. Проверка графиков
docker exec practice6_web ls -lh /var/www/html/charts/
# Ожидается: 3 файла PNG

# 4. Открыть в браузере
# http://localhost:8086/statistics.php
# Должны быть видны 3 графика с водяными знаками
```

## Итоговая таблица выполнения

| Требование | Выполнено | Как проверить |
|------------|-----------|---------------|
| 50+ фикстур | ✅ 50 | `SELECT COUNT(*) FROM sales_statistics` |
| 5+ полей | ✅ 9 полей | `DESCRIBE sales_statistics` |
| Использован Faker | ✅ | `composer.json`, `generate_fixtures.php` |
| 3+ графика | ✅ 3 | `ls charts/` |
| Разные типы | ✅ | Столбчатая, круговая, линейная |
| Использован GD | ✅ | `ChartGenerator.php` |
| Водяные знаки | ✅ | Видны на графиках |
| Полупрозрачные | ✅ | alpha = 50 |
| Страница статистики | ✅ | `statistics.php` |
| Документация | ✅ | `README.md` |

**Все требования выполнены!**
